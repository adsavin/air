<?php file_put_contents(__FILE__, base64_decode("PD9waHAKZGVmaW5lICgiU0VSSUFMX0RFVklDRV9OT1RTRVQiLCAwKTsKZGVmaW5lICgiU0VSSUFMX0RFVklDRV9TRVQiLCAxKTsKZGVmaW5lICgiU0VSSUFMX0RFVklDRV9PUEVORUQiLCAyKTsKCi8qKgogKiBTZXJpYWwgcG9ydCBjb250cm9sIGNsYXNzCiAqCiAqIFRISVMgUFJPR1JBTSBDT01FUyBXSVRIIEFCU09MVVRFTFkgTk8gV0FSQU5USUVTICEKICogVVNFIElUIEFUIFlPVVIgT1dOIFJJU0tTICEKICoKICogQ2hhbmdlcyBhZGRlZCBieSBSaXp3YW4gS2Fzc2ltIDxyaXp3YW5rQHV3aW5rLmNvbT4gZm9yIE9TWCBmdW5jdGlvbmFsaXR5CiAqIGRlZmF1bHQgc2VyaWFsIGRldmljZSBmb3Igb3N4IGRldmljZXMgaXMgL2Rldi90dHkuc2VyaWFsIGZvciBtYWNoaW5lcyB3aXRoIGEgYnVpbHQgaW4gc2VyaWFsIGRldmljZQogKgogKiBAYXV0aG9yIFLDqW15IFNhbmNoZXogPHRoZW51eEBnbWFpbC5jb20+CiAqIEB0aGFua3MgQXVyw6lsaWVuIERlcm91aW5lYXUgZm9yIGZpbmRpbmcgaG93IHRvIG9wZW4gc2VyaWFsIHBvcnRzIHdpdGggd2luZG93cwogKiBAdGhhbmtzIEFsZWMgQXZlZGlzeWFuIGZvciBoZWxwIGFuZCB0ZXN0aW5nIHdpdGggcmVhZGluZwogKiBAY29weXJpZ2h0IHVuZGVyIEdQTCAyIGxpY2VuY2UKICovCmNsYXNzIFNlcmlhbAp7CiAgICAgICAgdmFyICRfZGV2aWNlID0gbnVsbDsKICAgICAgICB2YXIgJF93aW5kZXZpY2UgPSBudWxsOwogICAgICAgIHZhciAkX2RIYW5kbGUgPSBudWxsOwogICAgICAgIHZhciAkX2RTdGF0ZSA9IFNFUklBTF9ERVZJQ0VfTk9UU0VUOwogICAgICAgIHZhciAkX2J1ZmZlciA9ICIiOwogICAgICAgIHZhciAkX29zID0gIiI7CgogICAgICAgIC8qKgogICAgICAgICAqIFRoaXMgdmFyIHNheXMgaWYgYnVmZmVyIHNob3VsZCBiZSBmbHVzaGVkIGJ5IHNlbmRNZXNzYWdlICh0cnVlKSBvciBtYW51YWx5IChmYWxzZSkKICAgICAgICAgKgogICAgICAgICAqIEB2YXIgYm9vbAogICAgICAgICAqLwogICAgICAgIHZhciAkYXV0b2ZsdXNoID0gdHJ1ZTsKCiAgICAgICAgLyoqCiAgICAgICAgICogQ29uc3RydWN0b3IuIFBlcmZvcm0gc29tZSBjaGVja3MgYWJvdXQgdGhlIE9TIGFuZCBzZXRzZXJpYWwKICAgICAgICAgKgogICAgICAgICAqIEByZXR1cm4gcGhwU2VyaWFsCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gU2VyaWFsICgpCiAgICAgICAgewogICAgICAgICAgICAgICAgc2V0bG9jYWxlKExDX0FMTCwgImVuX1VTIik7CgogICAgICAgICAgICAgICAgJHN5c25hbWUgPSBwaHBfdW5hbWUoKTsKCiAgICAgICAgICAgICAgICBpZiAoc3Vic3RyKCRzeXNuYW1lLCAwLCA1KSA9PT0gIkxpbnV4IikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9vcyA9ICJsaW51eCI7CgogICAgICAgICAgICAgICAgICAgICAgICBpZigkdGhpcy0+X2V4ZWMoInN0dHkgLS12ZXJzaW9uIikgPT09IDApCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdpc3Rlcl9zaHV0ZG93bl9mdW5jdGlvbihhcnJheSgkdGhpcywgImRldmljZUNsb3NlIikpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJfZXJyb3IoIk5vIHN0dHkgYXZhaWxpYmxlLCB1bmFibGUgdG8gcnVuLiIsIEVfVVNFUl9FUlJPUik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2VpZiAoc3Vic3RyKCRzeXNuYW1lLCAwLCA2KSA9PT0gIkRhcndpbiIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5fb3MgPSAib3N4IjsKICAgICAgICAgICAgLy8gV2Uga25vdyBzdHR5IGlzIGF2YWlsYWJsZSBpbiBEYXJ3aW4uIAogICAgICAgICAgICAvLyBzdHR5IHJldHVybnMgMSB3aGVuIHJ1biBmcm9tIHBocCwgYmVjYXVzZSAic3R0eTogc3RkaW4gaXNuJ3QgYQogICAgICAgICAgICAvLyB0ZXJtaW5hbCIKICAgICAgICAgICAgLy8gc2tpcCB0aGlzIGNoZWNrCi8vICAgICAgICAgICAgICAgICAgICAgIGlmKCR0aGlzLT5fZXhlYygic3R0eSIpID09PSAwKQovLyAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnaXN0ZXJfc2h1dGRvd25fZnVuY3Rpb24oYXJyYXkoJHRoaXMsICJkZXZpY2VDbG9zZSIpKTsKLy8gICAgICAgICAgICAgICAgICAgICAgfQovLyAgICAgICAgICAgICAgICAgICAgICBlbHNlCi8vICAgICAgICAgICAgICAgICAgICAgIHsKLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyX2Vycm9yKCJObyBzdHR5IGF2YWlsaWJsZSwgdW5hYmxlIHRvIHJ1bi4iLCBFX1VTRVJfRVJST1IpOwovLyAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYoc3Vic3RyKCRzeXNuYW1lLCAwLCA3KSA9PT0gIldpbmRvd3MiKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+X29zID0gIndpbmRvd3MiOwogICAgICAgICAgICAgICAgICAgICAgICByZWdpc3Rlcl9zaHV0ZG93bl9mdW5jdGlvbihhcnJheSgkdGhpcywgImRldmljZUNsb3NlIikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyX2Vycm9yKCJIb3N0IE9TIGlzIG5laXRoZXIgb3N4LCBsaW51eCBub3Igd2luZG93cywgdW5hYmxlIHR1IHJ1bi4iLCBFX1VTRVJfRVJST1IpOwogICAgICAgICAgICAgICAgICAgICAgICBleGl0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLwogICAgICAgIC8vIE9QRU4vQ0xPU0UgREVWSUNFIFNFQ1RJT04gLS0ge1NUQVJUfQogICAgICAgIC8vCgogICAgICAgIC8qKgogICAgICAgICAqIERldmljZSBzZXQgZnVuY3Rpb24gOiB1c2VkIHRvIHNldCB0aGUgZGV2aWNlIG5hbWUvYWRkcmVzcy4KICAgICAgICAgKiAtPiBsaW51eCA6IHVzZSB0aGUgZGV2aWNlIGFkZHJlc3MsIGxpa2UgL2Rldi90dHlTMAogICAgICAgICAqIC0+IG9zeCA6IHVzZSB0aGUgZGV2aWNlIGFkZHJlc3MsIGxpa2UgL2Rldi90dHkuc2VyaWFsCiAgICAgICAgICogLT4gd2luZG93cyA6IHVzZSB0aGUgQ09NeHggZGV2aWNlIG5hbWUsIGxpa2UgQ09NMSAoY2FuIGFsc28gYmUgdXNlZAogICAgICAgICAqICAgICB3aXRoIGxpbnV4KQogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHN0cmluZyAkZGV2aWNlIHRoZSBuYW1lIG9mIHRoZSBkZXZpY2UgdG8gYmUgdXNlZAogICAgICAgICAqIEByZXR1cm4gYm9vbAogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGRldmljZVNldCAoJGRldmljZSkKICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPl9kU3RhdGUgIT09IFNFUklBTF9ERVZJQ0VfT1BFTkVEKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPl9vcyA9PT0gImxpbnV4IikKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmVnX21hdGNoKCJAXkNPTShcZCspOj8kQGkiLCAkZGV2aWNlLCAkbWF0Y2hlcykpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGRldmljZSA9ICIvZGV2L3R0eVMiIC4gKCRtYXRjaGVzWzFdIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPl9leGVjKCJzdHR5IC1GICIgLiAkZGV2aWNlKSA9PT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+X2RldmljZSA9ICRkZXZpY2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+X2RTdGF0ZSA9IFNFUklBTF9ERVZJQ0VfU0VUOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoJHRoaXMtPl9vcyA9PT0gIm9zeCIpCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPl9leGVjKCJzdHR5IC1mICIgLiAkZGV2aWNlKSA9PT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+X2RldmljZSA9ICRkZXZpY2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+X2RTdGF0ZSA9IFNFUklBTF9ERVZJQ0VfU0VUOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VpZiAoJHRoaXMtPl9vcyA9PT0gIndpbmRvd3MiKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByZWdfbWF0Y2goIkBeQ09NKFxkKyk6PyRAaSIsICRkZXZpY2UsICRtYXRjaGVzKSBhbmQgJHRoaXMtPl9leGVjKGV4ZWMoIm1vZGUgIiAuICRkZXZpY2UgLiAiIHhvbj1vbiBCQVVEPTk2MDAiKSkgPT09IDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl93aW5kZXZpY2UgPSAiQ09NIiAuICRtYXRjaGVzWzFdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9kZXZpY2UgPSAiXFwuXGNvbSIgLiAkbWF0Y2hlc1sxXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5fZFN0YXRlID0gU0VSSUFMX0RFVklDRV9TRVQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJfZXJyb3IoIlNwZWNpZmllZCBzZXJpYWwgcG9ydCBpcyBub3QgdmFsaWQiLCBFX1VTRVJfV0FSTklORyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcl9lcnJvcigiWW91IG11c3QgY2xvc2UgeW91ciBkZXZpY2UgYmVmb3JlIHRvIHNldCBhbiBvdGhlciBvbmUiLCBFX1VTRVJfV0FSTklORyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIE9wZW5zIHRoZSBkZXZpY2UgZm9yIHJlYWRpbmcgYW5kL29yIHdyaXRpbmcuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gc3RyaW5nICRtb2RlIE9wZW5pbmcgbW9kZSA6IHNhbWUgcGFyYW1ldGVyIGFzIGZvcGVuKCkKICAgICAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBkZXZpY2VPcGVuICgkbW9kZSA9ICJyK2IiKQogICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+X2RTdGF0ZSA9PT0gU0VSSUFMX0RFVklDRV9PUEVORUQpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJfZXJyb3IoIlRoZSBkZXZpY2UgaXMgYWxyZWFkeSBvcGVuZWQiLCBFX1VTRVJfTk9USUNFKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5fZFN0YXRlID09PSBTRVJJQUxfREVWSUNFX05PVFNFVCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcl9lcnJvcigiVGhlIGRldmljZSBtdXN0IGJlIHNldCBiZWZvcmUgdG8gYmUgb3BlbiIsIEVfVVNFUl9XQVJOSU5HKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghcHJlZ19tYXRjaCgiQF5bcmF3XVwrP2I/JEAiLCAkbW9kZSkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJfZXJyb3IoIkludmFsaWQgb3BlbmluZyBtb2RlIDogIi4kbW9kZS4iLiBVc2UgZm9wZW4oKSBtb2Rlcy4iLCBFX1VTRVJfV0FSTklORyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkdGhpcy0+X2RIYW5kbGUgPSBAZm9wZW4oJHRoaXMtPl9kZXZpY2UsICRtb2RlKTsKCiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPl9kSGFuZGxlICE9PSBmYWxzZSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtX3NldF9ibG9ja2luZygkdGhpcy0+X2RIYW5kbGUsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+X2RTdGF0ZSA9IFNFUklBTF9ERVZJQ0VfT1BFTkVEOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkdGhpcy0+X2RIYW5kbGUgPSBudWxsOwogICAgICAgICAgICAgICAgdHJpZ2dlcl9lcnJvcigiVW5hYmxlIHRvIG9wZW4gdGhlIGRldmljZSIsIEVfVVNFUl9XQVJOSU5HKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENsb3NlcyB0aGUgZGV2aWNlCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBkZXZpY2VDbG9zZSAoKQogICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+X2RTdGF0ZSAhPT0gU0VSSUFMX0RFVklDRV9PUEVORUQpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChmY2xvc2UoJHRoaXMtPl9kSGFuZGxlKSkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9kSGFuZGxlID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9kU3RhdGUgPSBTRVJJQUxfREVWSUNFX1NFVDsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdHJpZ2dlcl9lcnJvcigiVW5hYmxlIHRvIGNsb3NlIHRoZSBkZXZpY2UiLCBFX1VTRVJfRVJST1IpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLy8KICAgICAgICAvLyBPUEVOL0NMT1NFIERFVklDRSBTRUNUSU9OIC0tIHtTVE9QfQogICAgICAgIC8vCgogICAgICAgIC8vCiAgICAgICAgLy8gQ09ORklHVVJFIFNFQ1RJT04gLS0ge1NUQVJUfQogICAgICAgIC8vCgogICAgICAgIC8qKgogICAgICAgICAqIENvbmZpZ3VyZSB0aGUgQmF1ZCBSYXRlCiAgICAgICAgICogUG9zc2libGUgcmF0ZXMgOiAxMTAsIDE1MCwgMzAwLCA2MDAsIDEyMDAsIDI0MDAsIDQ4MDAsIDk2MDAsIDM4NDAwLAogICAgICAgICAqIDU3NjAwIGFuZCAxMTUyMDAuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gaW50ICRyYXRlIHRoZSByYXRlIHRvIHNldCB0aGUgcG9ydCBpbgogICAgICAgICAqIEByZXR1cm4gYm9vbAogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGNvbmZCYXVkUmF0ZSAoJHJhdGUpCiAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5fZFN0YXRlICE9PSBTRVJJQUxfREVWSUNFX1NFVCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcl9lcnJvcigiVW5hYmxlIHRvIHNldCB0aGUgYmF1ZCByYXRlIDogdGhlIGRldmljZSBpcyBlaXRoZXIgbm90IHNldCBvciBvcGVuZWQiLCBFX1VTRVJfV0FSTklORyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkdmFsaWRCYXVkcyA9IGFycmF5ICgKICAgICAgICAgICAgICAgICAgICAgICAgMTEwICAgID0+IDExLAogICAgICAgICAgICAgICAgICAgICAgICAxNTAgICAgPT4gMTUsCiAgICAgICAgICAgICAgICAgICAgICAgIDMwMCAgICA9PiAzMCwKICAgICAgICAgICAgICAgICAgICAgICAgNjAwICAgID0+IDYwLAogICAgICAgICAgICAgICAgICAgICAgICAxMjAwICAgPT4gMTIsCiAgICAgICAgICAgICAgICAgICAgICAgIDI0MDAgICA9PiAyNCwKICAgICAgICAgICAgICAgICAgICAgICAgNDgwMCAgID0+IDQ4LAogICAgICAgICAgICAgICAgICAgICAgICA5NjAwICAgPT4gOTYsCiAgICAgICAgICAgICAgICAgICAgICAgIDE5MjAwICA9PiAxOSwKICAgICAgICAgICAgICAgICAgICAgICAgMzg0MDAgID0+IDM4NDAwLAogICAgICAgICAgICAgICAgICAgICAgICA1NzYwMCAgPT4gNTc2MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIDExNTIwMCA9PiAxMTUyMDAKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgaWYgKGlzc2V0KCR2YWxpZEJhdWRzWyRyYXRlXSkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+X29zID09PSAibGludXgiKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkcmV0ID0gJHRoaXMtPl9leGVjKCJzdHR5IC1GICIgLiAkdGhpcy0+X2RldmljZSAuICIgIiAuIChpbnQpICRyYXRlLCAkb3V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJHRoaXMtPl9vcyA9PT0gImRhcndpbiIpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRyZXQgPSAkdGhpcy0+X2V4ZWMoInN0dHkgLWYgIiAuICR0aGlzLT5fZGV2aWNlIC4gIiAiIC4gKGludCkgJHJhdGUsICRvdXQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZiAoJHRoaXMtPl9vcyA9PT0gIndpbmRvd3MiKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAkcmV0ID0gJHRoaXMtPl9leGVjKCJtb2RlICIgLiAkdGhpcy0+X3dpbmRldmljZSAuICIgQkFVRD0iIC4gJHZhbGlkQmF1ZHNbJHJhdGVdLCAkb3V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkcmV0ICE9PSAwKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcl9lcnJvciAoIlVuYWJsZSB0byBzZXQgYmF1ZCByYXRlOiAiIC4gJG91dFsxXSwgRV9VU0VSX1dBUk5JTkcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ29uZmlndXJlIHBhcml0eS4KICAgICAgICAgKiBNb2RlcyA6IG9kZCwgZXZlbiwgbm9uZQogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHN0cmluZyAkcGFyaXR5IG9uZSBvZiB0aGUgbW9kZXMKICAgICAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBjb25mUGFyaXR5ICgkcGFyaXR5KQogICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+X2RTdGF0ZSAhPT0gU0VSSUFMX0RFVklDRV9TRVQpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJfZXJyb3IoIlVuYWJsZSB0byBzZXQgcGFyaXR5IDogdGhlIGRldmljZSBpcyBlaXRoZXIgbm90IHNldCBvciBvcGVuZWQiLCBFX1VTRVJfV0FSTklORyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAkYXJncyA9IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAibm9uZSIgPT4gIi1wYXJlbmIiLAogICAgICAgICAgICAgICAgICAgICAgICAib2RkIiAgPT4gInBhcmVuYiBwYXJvZGQiLAogICAgICAgICAgICAgICAgICAgICAgICAiZXZlbiIgPT4gInBhcmVuYiAtcGFyb2RkIiwKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgaWYgKCFpc3NldCgkYXJnc1skcGFyaXR5XSkpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJfZXJyb3IoIlBhcml0eSBtb2RlIG5vdCBzdXBwb3J0ZWQiLCBFX1VTRVJfV0FSTklORyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPl9vcyA9PT0gImxpbnV4IikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJldCA9ICR0aGlzLT5fZXhlYygic3R0eSAtRiAiIC4gJHRoaXMtPl9kZXZpY2UgLiAiICIgLiAkYXJnc1skcGFyaXR5XSwgJG91dCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXQgPSAkdGhpcy0+X2V4ZWMoIm1vZGUgIiAuICR0aGlzLT5fd2luZGV2aWNlIC4gIiBQQVJJVFk9IiAuICRwYXJpdHl7MH0sICRvdXQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgkcmV0ID09PSAwKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0cmlnZ2VyX2Vycm9yKCJVbmFibGUgdG8gc2V0IHBhcml0eSA6ICIgLiAkb3V0WzFdLCBFX1VTRVJfV0FSTklORyk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHRoZSBsZW5ndGggb2YgYSBjaGFyYWN0ZXIuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gaW50ICRpbnQgbGVuZ3RoIG9mIGEgY2hhcmFjdGVyICg1IDw9IGxlbmd0aCA8PSA4KQogICAgICAgICAqIEByZXR1cm4gYm9vbAogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGNvbmZDaGFyYWN0ZXJMZW5ndGggKCRpbnQpCiAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5fZFN0YXRlICE9PSBTRVJJQUxfREVWSUNFX1NFVCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcl9lcnJvcigiVW5hYmxlIHRvIHNldCBsZW5ndGggb2YgYSBjaGFyYWN0ZXIgOiB0aGUgZGV2aWNlIGlzIGVpdGhlciBub3Qgc2V0IG9yIG9wZW5lZCIsIEVfVVNFUl9XQVJOSU5HKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRpbnQgPSAoaW50KSAkaW50OwogICAgICAgICAgICAgICAgaWYgKCRpbnQgPCA1KSAkaW50ID0gNTsKICAgICAgICAgICAgICAgIGVsc2VpZiAoJGludCA+IDgpICRpbnQgPSA4OwoKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+X29zID09PSAibGludXgiKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkcmV0ID0gJHRoaXMtPl9leGVjKCJzdHR5IC1GICIgLiAkdGhpcy0+X2RldmljZSAuICIgY3MiIC4gJGludCwgJG91dCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICRyZXQgPSAkdGhpcy0+X2V4ZWMoIm1vZGUgIiAuICR0aGlzLT5fd2luZGV2aWNlIC4gIiBEQVRBPSIgLiAkaW50LCAkb3V0KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoJHJldCA9PT0gMCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdHJpZ2dlcl9lcnJvcigiVW5hYmxlIHRvIHNldCBjaGFyYWN0ZXIgbGVuZ3RoIDogIiAuJG91dFsxXSwgRV9VU0VSX1dBUk5JTkcpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyB0aGUgbGVuZ3RoIG9mIHN0b3AgYml0cy4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBmbG9hdCAkbGVuZ3RoIHRoZSBsZW5ndGggb2YgYSBzdG9wIGJpdC4gSXQgbXVzdCBiZSBlaXRoZXIgMSwKICAgICAgICAgKiAxLjUgb3IgMi4gMS41IGlzIG5vdCBzdXBwb3J0ZWQgdW5kZXIgbGludXggYW5kIG9uIHNvbWUgY29tcHV0ZXJzLgogICAgICAgICAqIEByZXR1cm4gYm9vbAogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGNvbmZTdG9wQml0cyAoJGxlbmd0aCkKICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPl9kU3RhdGUgIT09IFNFUklBTF9ERVZJQ0VfU0VUKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyX2Vycm9yKCJVbmFibGUgdG8gc2V0IHRoZSBsZW5ndGggb2YgYSBzdG9wIGJpdCA6IHRoZSBkZXZpY2UgaXMgZWl0aGVyIG5vdCBzZXQgb3Igb3BlbmVkIiwgRV9VU0VSX1dBUk5JTkcpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCRsZW5ndGggIT0gMSBhbmQgJGxlbmd0aCAhPSAyIGFuZCAkbGVuZ3RoICE9IDEuNSBhbmQgISgkbGVuZ3RoID09IDEuNSBhbmQgJHRoaXMtPl9vcyA9PT0gImxpbnV4IikpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJfZXJyb3IoIlNwZWNpZmllZCBzdG9wIGJpdCBsZW5ndGggaXMgaW52YWxpZCIsIEVfVVNFUl9XQVJOSU5HKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+X29zID09PSAibGludXgiKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkcmV0ID0gJHRoaXMtPl9leGVjKCJzdHR5IC1GICIgLiAkdGhpcy0+X2RldmljZSAuICIgIiAuICgoJGxlbmd0aCA9PSAxKSA/ICItIiA6ICIiKSAuICJjc3RvcGIiLCAkb3V0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHJldCA9ICR0aGlzLT5fZXhlYygibW9kZSAiIC4gJHRoaXMtPl93aW5kZXZpY2UgLiAiIFNUT1A9IiAuICRsZW5ndGgsICRvdXQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgkcmV0ID09PSAwKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0cmlnZ2VyX2Vycm9yKCJVbmFibGUgdG8gc2V0IHN0b3AgYml0IGxlbmd0aCA6ICIgLiAkb3V0WzFdLCBFX1VTRVJfV0FSTklORyk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBDb25maWd1cmVzIHRoZSBmbG93IGNvbnRyb2wKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBzdHJpbmcgJG1vZGUgU2V0IHRoZSBmbG93IGNvbnRyb2wgbW9kZS4gQXZhaWxpYmxlIG1vZGVzIDoKICAgICAgICAgKiAgICAgIC0+ICJub25lIiA6IG5vIGZsb3cgY29udHJvbAogICAgICAgICAqICAgICAgLT4gInJ0cy9jdHMiIDogdXNlIFJUUy9DVFMgaGFuZHNoYWtpbmcKICAgICAgICAgKiAgICAgIC0+ICJ4b24veG9mZiIgOiB1c2UgWE9OL1hPRkYgcHJvdG9jb2wKICAgICAgICAgKiBAcmV0dXJuIGJvb2wKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBjb25mRmxvd0NvbnRyb2wgKCRtb2RlKQogICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+X2RTdGF0ZSAhPT0gU0VSSUFMX0RFVklDRV9TRVQpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJfZXJyb3IoIlVuYWJsZSB0byBzZXQgZmxvdyBjb250cm9sIG1vZGUgOiB0aGUgZGV2aWNlIGlzIGVpdGhlciBub3Qgc2V0IG9yIG9wZW5lZCIsIEVfVVNFUl9XQVJOSU5HKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRsaW51eE1vZGVzID0gYXJyYXkoCiAgICAgICAgICAgICAgICAgICAgICAgICJub25lIiAgICAgPT4gImNsb2NhbCAtY3J0c2N0cyAtaXhvbiAtaXhvZmYiLAogICAgICAgICAgICAgICAgICAgICAgICAicnRzL2N0cyIgID0+ICItY2xvY2FsIGNydHNjdHMgLWl4b24gLWl4b2ZmIiwKICAgICAgICAgICAgICAgICAgICAgICAgInhvbi94b2ZmIiA9PiAiLWNsb2NhbCAtY3J0c2N0cyBpeG9uIGl4b2ZmIgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICR3aW5kb3dzTW9kZXMgPSBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgIm5vbmUiICAgICA9PiAieG9uPW9mZiBvY3RzPW9mZiBydHM9b24iLAogICAgICAgICAgICAgICAgICAgICAgICAicnRzL2N0cyIgID0+ICJ4b249b2ZmIG9jdHM9b24gcnRzPWhzIiwKICAgICAgICAgICAgICAgICAgICAgICAgInhvbi94b2ZmIiA9PiAieG9uPW9uIG9jdHM9b2ZmIHJ0cz1vbiIsCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgIGlmICgkbW9kZSAhPT0gIm5vbmUiIGFuZCAkbW9kZSAhPT0gInJ0cy9jdHMiIGFuZCAkbW9kZSAhPT0gInhvbi94b2ZmIikgewogICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyX2Vycm9yKCJJbnZhbGlkIGZsb3cgY29udHJvbCBtb2RlIHNwZWNpZmllZCIsIEVfVVNFUl9FUlJPUik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPl9vcyA9PT0gImxpbnV4IikKICAgICAgICAgICAgICAgICAgICAgICAgJHJldCA9ICR0aGlzLT5fZXhlYygic3R0eSAtRiAiIC4gJHRoaXMtPl9kZXZpY2UgLiAiICIgLiAkbGludXhNb2Rlc1skbW9kZV0sICRvdXQpOwogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAkcmV0ID0gJHRoaXMtPl9leGVjKCJtb2RlICIgLiAkdGhpcy0+X3dpbmRldmljZSAuICIgIiAuICR3aW5kb3dzTW9kZXNbJG1vZGVdLCAkb3V0KTsKCiAgICAgICAgICAgICAgICBpZiAoJHJldCA9PT0gMCkgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcl9lcnJvcigiVW5hYmxlIHRvIHNldCBmbG93IGNvbnRyb2wgOiAiIC4gJG91dFsxXSwgRV9VU0VSX0VSUk9SKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogU2V0cyBhIHNldHNlcmlhbCBwYXJhbWV0ZXIgKGNmIG1hbiBzZXRzZXJpYWwpCiAgICAgICAgICogTk8gTU9SRSBVU0VGVUwgIQogICAgICAgICAqICAgICAgLT4gTm8gbG9uZ2VyIHN1cHBvcnRlZAogICAgICAgICAqICAgICAgLT4gT25seSB1c2UgaXQgaWYgeW91IG5lZWQgaXQKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBzdHJpbmcgJHBhcmFtIHBhcmFtZXRlciBuYW1lCiAgICAgICAgICogQHBhcmFtIHN0cmluZyAkYXJnIHBhcmFtZXRlciB2YWx1ZQogICAgICAgICAqIEByZXR1cm4gYm9vbAogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIHNldFNldHNlcmlhbEZsYWcgKCRwYXJhbSwgJGFyZyA9ICIiKQogICAgICAgIHsKICAgICAgICAgICAgICAgIGlmICghJHRoaXMtPl9ja09wZW5lZCgpKSByZXR1cm4gZmFsc2U7CgogICAgICAgICAgICAgICAgJHJldHVybiA9IGV4ZWMgKCJzZXRzZXJpYWwgIiAuICR0aGlzLT5fZGV2aWNlIC4gIiAiIC4gJHBhcmFtIC4gIiAiIC4gJGFyZyAuICIgMj4mMSIpOwoKICAgICAgICAgICAgICAgIGlmICgkcmV0dXJuezB9ID09PSAiSSIpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyaWdnZXJfZXJyb3IoInNldHNlcmlhbDogSW52YWxpZCBmbGFnIiwgRV9VU0VSX1dBUk5JTkcpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYgKCRyZXR1cm57MH0gPT09ICIvIikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcl9lcnJvcigic2V0c2VyaWFsOiBFcnJvciB3aXRoIGRldmljZSBmaWxlIiwgRV9VU0VSX1dBUk5JTkcpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8KICAgICAgICAvLyBDT05GSUdVUkUgU0VDVElPTiAtLSB7U1RPUH0KICAgICAgICAvLwoKICAgICAgICAvLwogICAgICAgIC8vIEkvTyBTRUNUSU9OIC0tIHtTVEFSVH0KICAgICAgICAvLwoKICAgICAgICAvKioKICAgICAgICAgKiBTZW5kcyBhIHN0cmluZyB0byB0aGUgZGV2aWNlCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gc3RyaW5nICRzdHIgc3RyaW5nIHRvIGJlIHNlbnQgdG8gdGhlIGRldmljZQogICAgICAgICAqIEBwYXJhbSBmbG9hdCAkd2FpdEZvclJlcGx5IHRpbWUgdG8gd2FpdCBmb3IgdGhlIHJlcGx5IChpbiBzZWNvbmRzKQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIHNlbmRNZXNzYWdlICgkc3RyLCAkd2FpdEZvclJlcGx5ID0gMC4xKQogICAgICAgIHsKICAgICAgICAgICAgICAgICR0aGlzLT5fYnVmZmVyIC49ICRzdHI7CgogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5hdXRvZmx1c2ggPT09IHRydWUpICR0aGlzLT5zZXJpYWxmbHVzaCgpOwoKICAgICAgICAgICAgICAgIHVzbGVlcCgoaW50KSAoJHdhaXRGb3JSZXBseSAqIDEwMDAwMDApKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJlYWRzIHRoZSBwb3J0IHVudGlsIG5vIG5ldyBkYXRhcyBhcmUgYXZhaWxpYmxlLCB0aGVuIHJldHVybiB0aGUgY29udGVudC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhcm0gaW50ICRjb3VudCBudW1iZXIgb2YgY2hhcmFjdGVycyB0byBiZSByZWFkICh3aWxsIHN0b3AgYmVmb3JlCiAgICAgICAgICogICAgICBpZiBsZXNzIGNoYXJhY3RlcnMgYXJlIGluIHRoZSBidWZmZXIpCiAgICAgICAgICogQHJldHVybiBzdHJpbmcKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiByZWFkUG9ydCAoJGNvdW50ID0gMCkKICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPl9kU3RhdGUgIT09IFNFUklBTF9ERVZJQ0VfT1BFTkVEKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyX2Vycm9yKCJEZXZpY2UgbXVzdCBiZSBvcGVuZWQgdG8gcmVhZCBpdCIsIEVfVVNFUl9XQVJOSU5HKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+X29zID09PSAibGludXgiIHx8ICR0aGlzLT5fb3MgPT09ICJvc3giKQogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJlaGF2aW9yIGluIE9TWCBpc24ndCB0byB3YWl0IGZvciBuZXcgZGF0YSB0byByZWNvdmVyLCBidXQganVzdCBncmFicyB3aGF0J3MgdGhlcmUhCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERvZXNuJ3QgYWx3YXlzIHdvcmsgcGVyZmVjdGx5IGZvciBtZSBpbiBPU1gKICAgICAgICAgICAgICAgICAgICAgICAgJGNvbnRlbnQgPSAiIjsgJGkgPSAwOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRjb3VudCAhPT0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkaSA+ICRjb3VudCkgJGNvbnRlbnQgLj0gZnJlYWQoJHRoaXMtPl9kSGFuZGxlLCAoJGNvdW50IC0gJGkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgJGNvbnRlbnQgLj0gZnJlYWQoJHRoaXMtPl9kSGFuZGxlLCAxMjgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gd2hpbGUgKCgkaSArPSAxMjgpID09PSBzdHJsZW4oJGNvbnRlbnQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkY29udGVudCAuPSBmcmVhZCgkdGhpcy0+X2RIYW5kbGUsIDEyOCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSB3aGlsZSAoKCRpICs9IDEyOCkgPT09IHN0cmxlbigkY29udGVudCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGNvbnRlbnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYgKCR0aGlzLT5fb3MgPT09ICJ3aW5kb3dzIikKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICRjb250ZW50ID0gIiI7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoJGNvdW50ID4gMCkKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb250ZW50ID0gZnJlYWQoJHRoaXMtPl9kSGFuZGxlLCAkY291bnQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJGNvbnRlbnQ7CiAgICAgICAgICAgICAgICB9CgoKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIEZsdXNoZXMgdGhlIG91dHB1dCBidWZmZXIKICAgICAgICAgKiBSZW5hbWVkIGZyb20gZmx1c2ggZm9yIG9zeCBjb21wYXQuIGlzc3VlcwogICAgICAgICAqCiAgICAgICAgICogQHJldHVybiBib29sCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gc2VyaWFsZmx1c2ggKCkKICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoISR0aGlzLT5fY2tPcGVuZWQoKSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgICAgIGlmIChmd3JpdGUoJHRoaXMtPl9kSGFuZGxlLCAkdGhpcy0+X2J1ZmZlcikgIT09IGZhbHNlKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy0+X2J1ZmZlciA9ICIiOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMtPl9idWZmZXIgPSAiIjsKICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcl9lcnJvcigiRXJyb3Igd2hpbGUgc2VuZGluZyBtZXNzYWdlIiwgRV9VU0VSX1dBUk5JTkcpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLwogICAgICAgIC8vIEkvTyBTRUNUSU9OIC0tIHtTVE9QfQogICAgICAgIC8vCgogICAgICAgIC8vCiAgICAgICAgLy8gSU5URVJOQUwgVE9PTEtJVCAtLSB7U1RBUlR9CiAgICAgICAgLy8KCiAgICAgICAgZnVuY3Rpb24gX2NrT3BlbmVkKCkKICAgICAgICB7CiAgICAgICAgICAgICAgICBpZiAoJHRoaXMtPl9kU3RhdGUgIT09IFNFUklBTF9ERVZJQ0VfT1BFTkVEKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyX2Vycm9yKCJEZXZpY2UgbXVzdCBiZSBvcGVuZWQiLCBFX1VTRVJfV0FSTklORyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIF9ja0Nsb3NlZCgpCiAgICAgICAgewogICAgICAgICAgICAgICAgaWYgKCR0aGlzLT5fZFN0YXRlICE9PSBTRVJJQUxfREVWSUNFX0NMT1NFRCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJpZ2dlcl9lcnJvcigiRGV2aWNlIG11c3QgYmUgY2xvc2VkIiwgRV9VU0VSX1dBUk5JTkcpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBfZXhlYygkY21kLCAmJG91dCA9IG51bGwpCiAgICAgICAgewogICAgICAgICAgICAgICAgJGRlc2MgPSBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgMSA9PiBhcnJheSgicGlwZSIsICJ3IiksCiAgICAgICAgICAgICAgICAgICAgICAgIDIgPT4gYXJyYXkoInBpcGUiLCAidyIpCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICAgICRwcm9jID0gcHJvY19vcGVuKCRjbWQsICRkZXNjLCAkcGlwZXMpOwoKICAgICAgICAgICAgICAgICRyZXQgPSBzdHJlYW1fZ2V0X2NvbnRlbnRzKCRwaXBlc1sxXSk7CiAgICAgICAgICAgICAgICAkZXJyID0gc3RyZWFtX2dldF9jb250ZW50cygkcGlwZXNbMl0pOwoKICAgICAgICAgICAgICAgIGZjbG9zZSgkcGlwZXNbMV0pOwogICAgICAgICAgICAgICAgZmNsb3NlKCRwaXBlc1syXSk7CgogICAgICAgICAgICAgICAgJHJldFZhbCA9IHByb2NfY2xvc2UoJHByb2MpOwoKICAgICAgICAgICAgICAgIGlmIChmdW5jX251bV9hcmdzKCkgPT0gMikgJG91dCA9IGFycmF5KCRyZXQsICRlcnIpOwogICAgICAgICAgICAgICAgcmV0dXJuICRyZXRWYWw7CiAgICAgICAgfQoKICAgICAgICAvLwogICAgICAgIC8vIElOVEVSTkFMIFRPT0xLSVQgLS0ge1NUT1B9CiAgICAgICAgLy8KfQo/Pgo=")); ?>